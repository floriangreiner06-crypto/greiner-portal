{% extends "base.html" %}
{% block content %}
<div class="dashboard-header">
    <h1>üîß Werkstatt-Auftr√§ge</h1>
    <p>Live-Daten aus Locosoft</p>
</div>
<div class="stats-grid">
    <div class="stat-card">
        <h3>{{ open_count }}</h3>
        <p>Offene Auftr√§ge</p>
    </div>
    <div class="stat-card">
        <h3>{{ total_count }}</h3>
        <p>Gesamt-Auftr√§ge</p>
    </div>
    <div class="stat-card">
        <h3>{{ ((open_count / total_count * 100) if total_count > 0 else 0)|round(1) }}%</h3>
        <p>Offen Quote</p>
    </div>
</div>
<div class="table-container">
    <h2>Offene Auftr√§ge (letzte 100)</h2>
    <table class="data-table">
        <thead>
            <tr>
                <th>Auftrag</th><th>Datum</th><th>Fahrzeug</th><th>Kunde</th>
                <th>KM-Stand</th><th>Fertig bis</th><th>Dringlichkeit</th><th>Status</th>
            </tr>
        </thead>
        <tbody>
            {% for order in orders %}
            <tr>
                <td><strong>{{ order.number }}</strong></td>
                <td>{{ order.date.strftime('%d.%m.%Y %H:%M') if order.date else '-' }}</td>
                <td>{{ order.vehicle or '-' }}</td>
                <td>{{ order.customer or '-' }}</td>
                <td>{{ '{:,}'.format(order.mileage).replace(',', '.') if order.mileage else '-' }} km</td>
                <td>{{ order.estimated_done.strftime('%d.%m.%Y %H:%M') if order.estimated_done else '-' }}</td>
                <td>
                    {% if order.urgency == 1 %}<span class="badge badge-danger">Eilig</span>
                    {% elif order.urgency == 2 %}<span class="badge badge-warning">Normal</span>
                    {% else %}<span class="badge badge-info">Niedrig</span>{% endif %}
                </td>
                <td>
                    {% if order.open %}<span class="badge badge-success">Offen</span>
                    {% else %}<span class="badge badge-secondary">Geschlossen</span>{% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
<style>
.stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
.stat-card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); text-align: center; }
.stat-card h3 { font-size: 2em; color: #2563eb; margin: 0; }
.stat-card p { color: #64748b; margin: 10px 0 0 0; }
.table-container { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); overflow-x: auto; }
.data-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
.data-table th { background: #f1f5f9; padding: 12px; text-align: left; font-weight: 600; border-bottom: 2px solid #e2e8f0; }
.data-table td { padding: 12px; border-bottom: 1px solid #e2e8f0; }
.data-table tr:hover { background: #f8fafc; }
.badge { padding: 4px 8px; border-radius: 4px; font-size: 0.875em; font-weight: 500; }
.badge-danger { background: #fee2e2; color: #dc2626; }
.badge-warning { background: #fef3c7; color: #d97706; }
.badge-info { background: #dbeafe; color: #2563eb; }
.badge-success { background: #d1fae5; color: #059669; }
.badge-secondary { background: #e2e8f0; color: #64748b; }
</style>
{% endblock %}
