<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fahrzeugfinanzierungen - Bankenspiegel 2.0</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f5f5f5; }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        /* Bank-Tabs */
        .bank-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            background: white;
            padding: 10px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .bank-tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            background: #f5f5f5;
            border: 2px solid transparent;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .bank-tab:hover {
            background: #e9ecef;
        }

        .bank-tab.active {
            background: white;
            border-color: #667eea;
            color: #667eea;
            font-weight: bold;
        }

        .bank-content {
            display: none;
        }

        .bank-content.active {
            display: block;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .stat-card h3 { font-size: 14px; color: #666; margin-bottom: 10px; }
        .stat-card .value { font-size: 28px; font-weight: bold; color: #333; }
        .stat-card .sub { font-size: 12px; color: #999; margin-top: 5px; }

        table {
            width: 100%;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        th, td { padding: 12px; text-align: left; }
        th { background: #667eea; color: white; font-weight: 600; }
        tr:nth-child(even) { background: #f9f9f9; }
        tr:hover { background: #f0f0f0; }

        .amount { text-align: right; font-weight: 600; }
        .positive { color: #28a745; }

        .nav-back {
            display: inline-block;
            padding: 10px 20px;
            background: white;
            color: #667eea;
            text-decoration: none;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        .nav-back:hover { background: #667eea; color: white; }
    </style>
</head>
<body>
    <div class="container">
        <a href="/bankenspiegel" class="nav-back">‚Üê Zur√ºck zum Dashboard</a>

        <div class="header">
            <h1>üöó Fahrzeugfinanzierungen</h1>
            <p>Stellantis & Santander Bestandskonten</p>
        </div>

        <!-- GESAMT-STATISTIK -->
        <div class="stats-grid">
            <div class="stat-card">
                <h3>Fahrzeuge gesamt</h3>
                <div class="value">{{ stats['anzahl_fahrzeuge'] }}</div>
            </div>
            <div class="stat-card">
                <h3>Aktueller Saldo</h3>
                <div class="value">{{ "{:,.2f}".format(stats['gesamt_saldo']) }} ‚Ç¨</div>
            </div>
            <div class="stat-card">
                <h3>Original Finanzierung</h3>
                <div class="value">{{ "{:,.2f}".format(stats['gesamt_original']) }} ‚Ç¨</div>
            </div>
            <div class="stat-card">
                <h3>Abbezahlt</h3>
                <div class="value positive">{{ "{:,.2f}".format(stats['gesamt_abbezahlt']) }} ‚Ç¨</div>
                <div class="sub">{{ "{:.1f}".format(stats['gesamt_abbezahlt'] / stats['gesamt_original'] * 100 if stats['gesamt_original'] > 0 else 0) }}%</div>
            </div>
        </div>

        <!-- BANK-TABS -->
        <div class="bank-tabs">
            {% for bank in stats_by_bank %}
            <div class="bank-tab {% if loop.first %}active{% endif %}" onclick="switchBank('{{ bank['finanzinstitut'] }}')">
                <h3>{{ bank['finanzinstitut'] }}</h3>
                <div style="font-size: 14px; color: #666;">{{ bank['anzahl'] }} Fahrzeuge</div>
                <div style="font-size: 18px; font-weight: bold; margin-top: 5px;">{{ "{:,.0f}".format(bank['saldo']) }} ‚Ç¨</div>
            </div>
            {% endfor %}
        </div>

        <!-- BANK-SPEZIFISCHE INHALTE -->
        {% for bank in stats_by_bank %}
        <div class="bank-content {% if loop.first %}active{% endif %}" id="content-{{ bank['finanzinstitut'] }}">
            <h2 style="margin-bottom: 20px;">{{ bank['finanzinstitut'] }}</h2>
            
            <!-- Stats dieser Bank -->
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>Fahrzeuge</h3>
                    <div class="value">{{ bank['anzahl'] }}</div>
                </div>
                <div class="stat-card">
                    <h3>Aktueller Saldo</h3>
                    <div class="value">{{ "{:,.2f}".format(bank['saldo']) }} ‚Ç¨</div>
                </div>
                <div class="stat-card">
                    <h3>Original</h3>
                    <div class="value">{{ "{:,.2f}".format(bank['original']) }} ‚Ç¨</div>
                </div>
                <div class="stat-card">
                    <h3>Abbezahlt</h3>
                    <div class="value positive">{{ "{:,.2f}".format(bank['original'] - bank['saldo']) }} ‚Ç¨</div>
                    <div class="sub">{{ "{:.1f}".format((bank['original'] - bank['saldo']) / bank['original'] * 100 if bank['original'] > 0 else 0) }}%</div>
                </div>
            </div>

            <!-- Fahrzeuge dieser Bank -->
            <h3 style="margin-top: 30px; margin-bottom: 15px;">Fahrzeuge (Top 50)</h3>
            <table>
                <tr>
                    <th>RRDI</th>
                    <th>Produktfamilie</th>
                    <th>VIN</th>
                    <th>Modell</th>
                    <th>Vertragsbeginn</th>
                    <th>Alter</th>
                    <th>Saldo</th>
                </tr>
                {% for fz in fahrzeuge if fz['finanzinstitut'] == bank['finanzinstitut'] %}
                {% if loop.index <= 50 %}
                <tr>
                    <td>{{ fz['rrdi'] }}</td>
                    <td>{{ fz['produktfamilie'] }}</td>
                    <td>{{ fz['vin'] }}</td>
                    <td>{{ fz['modell'] }}</td>
                    <td>{{ fz['vertragsbeginn'] }}</td>
                    <td>{{ fz['alter_tage'] }} Tage</td>
                    <td class="amount">{{ "{:,.2f}".format(fz['aktueller_saldo']) }} ‚Ç¨</td>
                </tr>
                {% endif %}
                {% endfor %}
            </table>
        </div>
        {% endfor %}
    </div>

    <script>
        function switchBank(bank) {
            // Tabs umschalten
            document.querySelectorAll('.bank-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.currentTarget.classList.add('active');

            // Content umschalten
            document.querySelectorAll('.bank-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById('content-' + bank).classList.add('active');
        }
    </script>
</body>
</html>
